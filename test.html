<html>
    <head>
        <script src="gl-matrix/gl-matrix.js"></script>
        <script src="webgl-utils.js"></script>
        <script src="token.js"></script>
        <script src="ast.js"></script>
        <script src="parse.js"></script>
        <script src="jsl.js"></script>
    </head>
    <body>
        <canvas syle="border:solid;" id='canvas' height='400' width='400'></canvas>
        <script type="text/javascript">

            var gl = jsl_init('canvas', {'clearColor': [0.5, 0.5, 0.5]});
            gl.enable(gl.BLEND);
            gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

            var shader = gl.ShaderFunction(
            function(mesh, mvpMat, texture) {
                gl_Position = mvpMat * vec4(mesh.position, 1.0);

                with((texCoord = mesh.texCoord)) {
                    gl_FragColor = texture2D(texture, texCoord);
                }
            });

            var square = {
                'position': new gl.Attribute('vec3', [
                    0, 0, 0,
                    1, 0, 0,
                    0, 1, 0,
                    1, 1, 0,
                ]),

                'index': new gl.IndexArray([0,1,3,0,2,3]),
                
                'texCoord': new gl.Attribute('vec2', [
                    0,0,
                    1,0,
                    0,1,
                    1,1,
                ]),
            };

            var clockface = new gl.Texture("clockface.jpg");
            var hand = new gl.Texture("hand.png");

            gl.transforms.projection.ortho2D(0,1,0,1);

            var rate = -6; // degrees / second
            gl.loop(function() {
                gl.clear();
                shader(square, gl.transforms.modelViewProjectionMatrix, clockface);

                gl.transforms.model.push();
                var theta_degrees = rate * (new Date()).getSeconds();
                gl.transforms.model.translate([0.5,0.5,1]);
                gl.transforms.model.scale([0.5,0.5,0]);
                gl.transforms.model.rotate(theta_degrees * Math.PI / 180, [0,0,1]);
                shader(square, gl.transforms.modelViewProjectionMatrix, hand);
                gl.transforms.model.pop();
            });

        </script>
    </body>
</html>
